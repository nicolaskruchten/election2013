<html>
<head>
	<title>Ã‰lection 2013</title>
	<meta charset="utf-8"> 
    <script type="text/javascript" src="jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="coffee-script.js"></script>
    <script type="text/javascript" src="protovis.min.js"></script>
    <script type="text/coffeescript" src="helpers.coffee"></script>
	<script type="text/coffeescript" src="mayors.coffee"> </script>
	<script type="text/coffeescript" src="council.coffee"> </script>
	<script type="text/coffeescript" src="singleRace.coffee"> </script>
	<script type="text/coffeescript" src="multiRace.coffee"> </script>
</head>
<style>
.container {
	position: absolute; 
	top:0px; 
	left: 0px; 
	width: 100%; 
	height: 100%; 
	border: 1px solid white;
}
</style>
<body>

<table cellpadding=5> 
	<tr><td>

	<div id="tl" style="position: relative; width: 500px; height: 300px;">
		<div id="mayors" class="container"></div>
		<div id="mc" class="container"></div>
		<div id="cv" class="container"></div>
		<div id="ca" class="container"></div>
		<div id="all" class="container"></div>
	</div>

</td><td>

	<div id="tr" style="position: relative; width: 500px; height: 300px;">
		<div id="multiRaceWithin" class="container"></div>
		<div id="multiRaceAbove" class="container"></div>
	</div>

</td></tr><tr><td>

	<div id="bl" style="position: relative; width: 500px; height: 300px;">
		<div id="singleRaceA" class="container"></div>
		<div id="singleRaceB" class="container"></div>
	</div>

</td><td>

	<div id="br" style="position: relative; width: 500px; height: 300px;">
		<div id="singleRaceC" class="container"></div>
		<div id="singleRaceD" class="container"></div>
	</div>

</td></tr>
</table>



<script type="text/coffeescript">


fadeLength = 2*1000
stayLength = 9*1000

swapperGen = (fns) ->
	cycleId =[]
	cycleFn = []
	for k,v of fns
		cycleId.push k
		cycleFn.push v
	loopPos = cycleId.length-1
	it = ->
		old = cycleId[loopPos]
		oldFn = cycleFn[loopPos]
		$("#"+old).fadeOut fadeLength, -> 
			oldFn()
			$("#"+old).hide()
		loopPos = (loopPos+1)%cycleId.length
		$("#"+cycleId[loopPos]).fadeIn fadeLength, -> setTimeout it, stayLength
	return it

tlCycle =
	"mayors": -> window.updateMayors("mayors")
	"mc": -> window.updateCouncil("mc", "MC")
	"cv": -> window.updateCouncil("cv", "CV")
	"ca": -> window.updateCouncil("ca", "CA")
	"all": -> window.updateCouncil("all")
		
blCycle =
	"singleRaceA": -> window.updateRandomRace("singleRaceA")
	"singleRaceB": -> window.updateRandomRace("singleRaceB")

trCycle = 
	"multiRaceAbove": -> window.updateMultiRace("multiRaceAbove", "above", 0.1)
	"multiRaceWithin": -> window.updateMultiRace("multiRaceWithin", "within", 0.1)

brCycle = 
	"singleRaceC": -> window.updateRandomRace("singleRaceC")
	"singleRaceD": -> window.updateRandomRace("singleRaceD")

setTimeout swapperGen(tlCycle), 1000
setTimeout swapperGen(blCycle), 4000
setTimeout swapperGen(trCycle), 7000
setTimeout swapperGen(brCycle), 10000

window.refreshData ->
	for fns in [brCycle, trCycle, tlCycle, blCycle]
		for k, v of fns
			v()
	$(".container").hide()

setInterval window.refreshData, 10000



</script>

</body>
</html>